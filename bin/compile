#!/bin/bash
# usage: bin/compile <build-dir> <cache-dir>

set -eo pipefail

mkdir -p "$1" "$2"
build=$(cd "$1/" && pwd)
cache=$(cd "$2/" && pwd)
funpack=$(cd $(dirname $0)/.. && pwd)

# ftb 5.2.0
ver="5.2.0"
url="http://funpack-assets.s3.amazonaws.com/FTB/direwolf20/$ver.zip"

if test -f $cache/ftb-$ver/ftbserver.jar
then
  echo "-----> Using Feed The Beast Version $ver"
else
  rm -rf $cache/*
  mkdir -p $cache/ftb-$ver
  cd $cache/ftb-$ver
  echo -n "-----> Installing Feed The Beast Version $ver"
  curl -L $url -o ftb.zip
  unzip ftb.zip
  rm ftb.zip
  echo " done"
fi
mkdir -p $build/ftb-$ver
cp -R $cache/ftb-$ver/* $build/ftb-$ver

# ftb 5.1.1
ver="5.1.1"
url="http://funpack-assets.s3.amazonaws.com/FTB/direwolf20/$ver.zip"

if test -f $cache/ftb-$ver/ftbserver.jar
then
  echo "-----> Using Feed The Beast Version $ver"
else
  mkdir -p $cache/ftb-$ver
  cd $cache/ftb-$ver
  echo -n "-----> Installing Feed The Beast Version $ver"
  curl -L $url -o ftb.zip
  unzip ftb.zip
  rm ftb.zip
  echo " done"
fi
mkdir -p $build/ftb-$ver
cp -R $cache/ftb-$ver/* $build/ftb-$ver

cd $funpack
mkdir -p $build/bin
cp bin/run $build/bin/run
cp bin/import $build/bin/import

cp -R lib $build
cp -R templates $build

cp Gemfile $build/Gemfile
cp Gemfile.lock $build/Gemfile.lock
cp funpack.json $build/funpack.json
